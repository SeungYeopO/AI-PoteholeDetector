<!DOCTYPE html>
<html>
<head>
    <title>Rotate Map</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAYY_7_SvYIBAR5lAtf84PMm5-keG1z0Gg"></script>
    <script>
        let map, infoWindow;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -34.397, lng: 150.644},
                zoom: 16,
                heading: 0  // 초기 방향 설정
            });
            infoWindow = new google.maps.InfoWindow;

            // Geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location found.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                handleLocationError(false, infoWindow, map.getCenter());
            }

            // Listen for orientation changes
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function(event) {
                    let alpha = event.alpha;
                    if (typeof event.webkitCompassHeading !== 'undefined') {
                        alpha = event.webkitCompassHeading; // iOS는 webkitCompassHeading을 사용
                        map.setHeading(360 - alpha); // 북쪽을 맞추기 위해 360에서 alpha를 뺌
                    } else {
                        const mapHeading = 360 - alpha; // 기타 디바이스
                        map.setHeading(mapHeading);
                    }
                });
            } else {
                alert("Sorry, your browser does not support Device Orientation");
            }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                                  'Error: The Geolocation service failed.' :
                                  'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
    </script>
</head>
<body>
    <div id="map" style="height: 500px; width: 100%;"></div>
    <script>
        initMap();
    </script>
</body>
</html>
